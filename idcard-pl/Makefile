.PHONY: build up down logs test clean help status dev install

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# POMOC
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

help:
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "  IDCard.pl - Gateway Integracji UsÅ‚ug Cyfrowych"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "Komendy developerskie:"
	@echo "  make install      - Instaluje zaleÅ¼noÅ›ci"
	@echo "  make dev          - Uruchamia w trybie developerskim"
	@echo "  make dev-backend  - Uruchamia tylko backend"
	@echo "  make dev-frontend - Uruchamia tylko frontend"
	@echo ""
	@echo "Komendy Docker:"
	@echo "  make build        - Buduje obrazy Docker"
	@echo "  make up           - Uruchamia kontenery"
	@echo "  make down         - Zatrzymuje kontenery"
	@echo "  make logs         - Pokazuje logi"
	@echo "  make status       - Status kontenerÃ³w"
	@echo "  make clean        - CzyÅ›ci zasoby Docker"
	@echo ""
	@echo "Testy:"
	@echo "  make test         - Uruchamia testy"
	@echo "  make test-api     - Testuje API"
	@echo ""
	@echo "CLI:"
	@echo "  make cli-login    - Zaloguj siÄ™"
	@echo "  make cli-register - Zarejestruj uÅ¼ytkownika"
	@echo "  make cli-connect  - PoÅ‚Ä…cz usÅ‚ugÄ™"
	@echo "  make cli-inbox    - PokaÅ¼ skrzynkÄ™"
	@echo ""
	@echo "DostÄ™p:"
	@echo "  Frontend:  http://localhost:4100"
	@echo "  API:       http://localhost:4000"
	@echo "  API Docs:  http://localhost:4000/docs"
	@echo ""
	@echo "Demo konto:"
	@echo "  Email:    demo@idcard.pl"
	@echo "  HasÅ‚o:    demo123"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# INSTALACJA
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

install:
	@echo "ğŸ“¦ Instalacja zaleÅ¼noÅ›ci..."
	cd frontend && npm install
	cd backend && pip install -r requirements.txt
	@echo "âœ… ZaleÅ¼noÅ›ci zainstalowane"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DEVELOPMENT
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

dev:
	@echo "ğŸš€ Uruchamianie w trybie developerskim..."
	@echo "Backend: http://localhost:4000"
	@echo "Frontend: http://localhost:4100"
	@make -j2 dev-backend dev-frontend

dev-backend:
	cd backend && uvicorn app.main:app --reload --host 0.0.0.0 --port 4000

dev-frontend:
	cd frontend && npm run dev -- --port 4100

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DOCKER
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

build:
	docker-compose build

up:
	docker-compose up --build -d
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "  IDCard.pl uruchomiony!"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "  Frontend:  http://localhost:4100"
	@echo "  API:       http://localhost:4000"
	@echo "  API Docs:  http://localhost:4000/docs"
	@echo ""
	@echo "  Demo:      demo@idcard.pl / demo123"
	@echo ""

down:
	docker-compose down

logs:
	docker-compose logs -f

status:
	@echo "Status kontenerÃ³w IDCard.pl:"
	@docker-compose ps

clean:
	docker-compose down -v --rmi local
	@echo "âœ… Zasoby Docker wyczyszczone"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TESTY
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

test:
	@echo "ğŸ§ª Uruchamianie testÃ³w..."
	cd backend && python -m pytest tests/ -v

test-api:
	@echo "ğŸ§ª Testowanie API..."
	@echo ""
	@echo "1. Health check:"
	@curl -s http://localhost:4000/health | python3 -m json.tool
	@echo ""
	@echo "2. Login (demo):"
	@curl -s -X POST http://localhost:4000/api/auth/login \
		-H "Content-Type: application/json" \
		-d '{"email":"demo@idcard.pl","password":"demo123"}' | python3 -m json.tool
	@echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CLI
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

cli-login:
	@./cli/idcard login -u demo@idcard.pl -p demo123

cli-register:
	@./cli/idcard register

cli-connect:
	@./cli/idcard connect

cli-inbox:
	@./cli/idcard inbox

cli-status:
	@./cli/idcard status

.PHONY: build up down logs test clean help simulator-logs proxy-logs status restart
.PHONY: all-up all-down all-status sync-up sync-down dsl-up dsl-down e2e-test

# DomyÅ›lny cel
help:
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "  e-DorÄ™czenia Proxy IMAP/SMTP"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "Komendy lokalne (ten projekt):"
	@echo "  make build      - Buduje obrazy Docker"
	@echo "  make up         - Uruchamia kontenery proxy"
	@echo "  make down       - Zatrzymuje kontenery proxy"
	@echo "  make logs       - Logi wszystkich kontenerÃ³w"
	@echo "  make test       - Uruchamia testy jednostkowe"
	@echo "  make status     - Status kontenerÃ³w"
	@echo "  make clean      - CzyÅ›ci zasoby Docker"
	@echo ""
	@echo "Komendy wszystkich usÅ‚ug:"
	@echo "  make all-up     - Uruchamia WSZYSTKIE usÅ‚ugi (proxy + sync + dsl)"
	@echo "  make all-down   - Zatrzymuje WSZYSTKIE usÅ‚ugi"
	@echo "  make all-status - Status wszystkich usÅ‚ug"
	@echo "  make e2e-test   - Testy E2E caÅ‚ego systemu"
	@echo ""
	@echo "Komendy innych usÅ‚ug:"
	@echo "  make sync-up    - Uruchamia middleware-sync"
	@echo "  make sync-down  - Zatrzymuje middleware-sync"
	@echo "  make dsl-up     - Uruchamia DSL"
	@echo "  make dsl-down   - Zatrzymuje DSL"
	@echo ""
	@echo "Logi poszczegÃ³lnych serwisÃ³w:"
	@echo "  make simulator-logs  - Logi symulatora API"
	@echo "  make proxy-logs      - Logi proxy IMAP/SMTP"
	@echo ""
	@echo "Dane dostÄ™powe (Proxy):"
	@echo "  Webmail:     http://localhost:9080"
	@echo "  API Docs:    http://localhost:8180/docs"
	@echo "  IMAP:        localhost:11143"
	@echo "  SMTP:        localhost:11025"
	@echo "  User/Pass:   testuser / testpass123"

# Budowanie obrazÃ³w
build:
	docker-compose build

# Uruchomienie
up:
	docker-compose up --build
	@echo ""
	@echo "=== Serwisy uruchomione ==="
	@echo "Webmail:     http://localhost:9080"
	@echo "API Docs:    http://localhost:8180/docs"
	@echo "IMAP:        localhost:11143"
	@echo "SMTP:        localhost:11025"
	@echo "User/Pass:   testuser / testpass123"

# Zatrzymanie
down:
	docker-compose down

# Logi wszystkich serwisÃ³w
logs:
	docker-compose logs -f

# Logi symulatora
simulator-logs:
	docker-compose logs -f edoreczenia-simulator

# Logi proxy
proxy-logs:
	docker-compose logs -f edoreczenia-proxy

# Uruchomienie testÃ³w
test:
	docker-compose --profile test up --build --abort-on-container-exit tests

# Czyszczenie
clean:
	docker-compose down -v --rmi local
	docker system prune -f

# Restart
restart: down up

# Status
status:
	docker-compose ps

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KOMENDY WSZYSTKICH USÅUG
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Uruchom wszystkie usÅ‚ugi
all-up:
	@echo "ğŸš€ Uruchamianie wszystkich usÅ‚ug e-DorÄ™czeÅ„..."
	docker-compose up -d --build
	@$(MAKE) -C ../edoreczenia-middleware-sync up-detached
	@$(MAKE) -C ../edoreczenia-dsl up-detached
	@echo ""
	@echo "âœ… Wszystkie usÅ‚ugi uruchomione!"
	@$(MAKE) all-status

# Zatrzymaj wszystkie usÅ‚ugi
all-down:
	@echo "ğŸ›‘ Zatrzymywanie wszystkich usÅ‚ug e-DorÄ™czeÅ„..."
	docker-compose down
	@$(MAKE) -C ../edoreczenia-middleware-sync down
	@$(MAKE) -C ../edoreczenia-dsl down
	@echo "âœ… Wszystkie usÅ‚ugi zatrzymane"

# Status wszystkich usÅ‚ug
all-status:
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "  STATUS WSZYSTKICH USÅUG e-DorÄ™czeÅ„"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ğŸ“¦ PROXY IMAP/SMTP (localhost:8180, :11143, :11025, :9080):"
	@docker-compose ps --format "table {{.Name}}\t{{.Status}}\t{{.Ports}}" 2>/dev/null || echo "  (nie uruchomiony)"
	@echo ""
	@echo "ğŸ“¦ MIDDLEWARE SYNC (localhost:8280, :21143, :9180):"
	@docker-compose -f ../edoreczenia-middleware-sync/docker-compose.yml ps --format "table {{.Name}}\t{{.Status}}\t{{.Ports}}" 2>/dev/null || echo "  (nie uruchomiony)"
	@echo ""
	@echo "ğŸ“¦ DSL (localhost:8380, :31143, :31025):"
	@docker-compose -f ../edoreczenia-dsl/docker-compose.yml ps --format "table {{.Name}}\t{{.Status}}\t{{.Ports}}" 2>/dev/null || echo "  (nie uruchomiony)"

# Testy E2E caÅ‚ego systemu
e2e-test:
	@echo "ğŸ§ª Uruchamianie testÃ³w E2E..."
	@python3 ../test_e2e.py

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KOMENDY INNYCH USÅUG
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Middleware Sync
sync-up:
	@$(MAKE) -C ../edoreczenia-middleware-sync up

sync-down:
	@$(MAKE) -C ../edoreczenia-middleware-sync down

sync-logs:
	@$(MAKE) -C ../edoreczenia-middleware-sync logs

sync-status:
	@$(MAKE) -C ../edoreczenia-middleware-sync status

# DSL
dsl-up:
	@$(MAKE) -C ../edoreczenia-dsl up

dsl-down:
	@$(MAKE) -C ../edoreczenia-dsl down

dsl-logs:
	@$(MAKE) -C ../edoreczenia-dsl logs

dsl-test:
	@$(MAKE) -C ../edoreczenia-dsl test

dsl-status:
	@$(MAKE) -C ../edoreczenia-dsl status

# Uruchomienie w tle (dla all-up)
up-detached:
	docker-compose up -d --build

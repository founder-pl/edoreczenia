.PHONY: build up down logs test clean help send receive sync

# DomyÅ›lny cel
help:
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "  e-DorÄ™czenia DSL - Apache Camel + Groovy"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "Komendy Docker:"
	@echo "  make build      - Buduje obrazy Docker"
	@echo "  make up         - Uruchamia wszystkie kontenery"
	@echo "  make down       - Zatrzymuje wszystkie kontenery"
	@echo "  make logs       - Pokazuje logi wszystkich kontenerÃ³w"
	@echo "  make clean      - CzyÅ›ci zasoby Docker"
	@echo ""
	@echo "Komendy DSL (Groovy):"
	@echo "  make send       - WysyÅ‚a testowÄ… wiadomoÅ›Ä‡"
	@echo "  make receive    - Odbiera wiadomoÅ›ci"
	@echo "  make sync       - Synchronizuje API â†’ IMAP"
	@echo ""
	@echo "PrzykÅ‚ady skryptÃ³w Groovy:"
	@echo "  groovy routes/send-document.groovy -f plik.pdf -r AE:PL-..."
	@echo "  groovy routes/receive-messages.groovy -f inbox -l 10"
	@echo ""
	@echo "Endpointy REST API (po uruchomieniu):"
	@echo "  POST http://localhost:8090/api/v1/messages      - WyÅ›lij"
	@echo "  GET  http://localhost:8090/api/v1/messages      - Odbierz"
	@echo "  POST http://localhost:8090/api/v1/sync/to-imap  - Sync"
	@echo ""
	@echo "Dane dostÄ™powe:"
	@echo "  DSL API:     http://localhost:8090"
	@echo "  Symulator:   http://localhost:8180/docs"
	@echo "  IMAP:        localhost:21143 (mailuser/mailpass123)"
	@echo "  SMTP Proxy:  localhost:11025 (testuser/testpass123)"

# Budowanie
build:
	docker-compose build

# Uruchomienie
up:
	docker-compose up --build
	@echo ""
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "  e-DorÄ™czenia DSL uruchomiony"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "  DSL API:     http://localhost:8090"
	@echo "  Symulator:   http://localhost:8180/docs"
	@echo ""
	@echo "  PrzykÅ‚ad wysyÅ‚ania:"
	@echo "    curl -X POST http://localhost:8090/api/v1/messages \\"
	@echo "      -H 'Content-Type: application/json' \\"
	@echo "      -d '{\"subject\":\"Test\",\"recipient\":\"AE:PL-...\",\"content\":\"TreÅ›Ä‡\"}'"

# Zatrzymanie
down:
	docker-compose down

# Logi
logs:
	docker-compose logs -f

# Logi DSL
dsl-logs:
	docker-compose logs -f edoreczenia-dsl

# Czyszczenie
clean:
	docker-compose down -v --rmi local
	rm -rf build/

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KOMENDY DSL
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# WysyÅ‚anie testowej wiadomoÅ›ci
send:
	@echo "ğŸ“¤ WysyÅ‚anie testowej wiadomoÅ›ci..."
	@curl -s -X POST http://localhost:8090/api/v1/messages \
		-H 'Content-Type: application/json' \
		-d '{"subject":"Test DSL","recipient":"AE:PL-ODBIORCA-TEST-00001","content":"WiadomoÅ›Ä‡ testowa z DSL"}' | python3 -m json.tool || echo "BÅ‚Ä…d - czy DSL jest uruchomiony?"

# Odbieranie wiadomoÅ›ci
receive:
	@echo "ğŸ“¥ Odbieranie wiadomoÅ›ci..."
	@curl -s http://localhost:8090/api/v1/messages | python3 -m json.tool || echo "BÅ‚Ä…d - czy DSL jest uruchomiony?"

# Synchronizacja
sync:
	@echo "ğŸ”„ Synchronizacja API â†’ IMAP..."
	@curl -s -X POST http://localhost:8090/api/v1/sync/to-imap | python3 -m json.tool || echo "BÅ‚Ä…d - czy DSL jest uruchomiony?"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SKRYPTY GROOVY (lokalne)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# WysyÅ‚anie dokumentu (Groovy)
send-doc:
	@echo "UÅ¼ycie: groovy routes/send-document.groovy -f PLIK -r ODBIORCA"
	@echo "PrzykÅ‚ad: groovy routes/send-document.groovy -f dokument.pdf -r AE:PL-ODBIORCA-00001"

# Odbieranie (Groovy)
receive-groovy:
	groovy routes/receive-messages.groovy -f inbox -l 10

# Test poÅ‚Ä…czenia
test:
	@echo "ğŸ§ª Test poÅ‚Ä…czenia z API..."
	@curl -s http://localhost:8180/health | python3 -m json.tool
	@echo ""
	@echo "ğŸ§ª Test DSL..."
	@python3 routes/test-dsl.py

# Status
status:
	docker-compose ps
